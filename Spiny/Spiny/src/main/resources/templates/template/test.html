<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <title>Create Template</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
</head>

<body>
<h2>Create Template</h2>

<form action="/template/processTemplate" method="post" id="templateForm">
  <label for="name">Template Name:</label>
  <input type="text" id="name" name="name" /><br />

  <!-- Hidden input field to store template -->
  <input type="hidden" id="template" name="template" />

  <div id="dataFieldContainer">
    <!-- Data field inputs will be appended here -->
  </div>

  <button type="button" onclick="addDataField()">Add Data Field</button>
  <br />

  <input type="submit" value="Create" />
</form>
<!-- HTML form -->

<script>
        var dataFieldIndex = 0;
        var dataFieldTypes = /*[[${dataFieldTypes}]]*/ []; // dataFieldTypes JavaScript dizisi olarak tanımlandı

        function addDataField() {
            var container = document.getElementById("dataFieldContainer");
            var div = document.createElement("div");

            var labelType = document.createElement("label");
            labelType.textContent = "Data Field Type:";
            div.appendChild(labelType);

            var selectType = document.createElement("select");
            selectType.name = "dataFieldTypes[" + dataFieldIndex + "]";

            // dataFieldTypes dizisinden seçenekler oluşturuluyor
            dataFieldTypes.forEach(function (dataFieldType) {
                var option = document.createElement("option");
                option.value = dataFieldType.id;
                option.textContent = dataFieldType.type;
                selectType.appendChild(option);
            });

            div.appendChild(selectType);

            var labelName = document.createElement("label");
            labelName.textContent = "Data Field Name:";
            div.appendChild(labelName);

            var inputName = document.createElement("input");
            inputName.type = "text";
            inputName.name = "dataFieldNames[" + dataFieldIndex + "]";
            div.appendChild(inputName);

            container.appendChild(div);

            dataFieldIndex++;
        }

        // Form submit işlemi öncesi veri alanlarını template'e ekleme
        $(document).ready(function () {
            $("#templateForm").submit(function () {
                var dataFieldTypesArray = [];
                var dataFieldNamesArray = [];

                // Her bir data field için veri alanı türünü ve ismini al
                $("select[name^='dataFieldTypes']").each(function () {
                    dataFieldTypesArray.push($(this).val());
                });

                $("input[name^='dataFieldNames']").each(function () {
                    dataFieldNamesArray.push($(this).val());
                });

                // Template nesnesine veri alanlarını ekle
                var template = {
                    name: $("#name").val(),
                    dataFields: []
                };

                for (var i = 0; i < dataFieldTypesArray.length; i++) {
                    var dataField = {
                        type: dataFieldTypesArray[i],
                        name: dataFieldNamesArray[i]
                    };
                    template.dataFields.push(dataField);
                }

                // Template nesnesini JSON formatına dönüştürerek gizli alana yerleştir
                $("#template").val(JSON.stringify(template));

                return true; // Form submit işlemine devam et
            });
        });
    </script>

</body>

</html>
